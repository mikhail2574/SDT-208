{% extends "base.html" %}

{% block content %}
<section class="hero">
    <div>
        <p class="eyebrow">Test library</p>
        <h1>Discover quizzes crafted by authors</h1>
        <p class="lede">Filter by difficulty, see status at a glance, and jump into practice.</p>
    </div>
    <div class="inline-actions">
        {% if current_user and (has_role(current_user, "AUTHOR") or has_role(current_user, "ADMIN")) %}
        <a class="primary-btn" href="/tests/new">Create test</a>
        {% else %}
        <a class="ghost-btn" href="/auth/login">Login to author</a>
        {% endif %}
    </div>
</section>

<section class="panel">
    <header class="panel__header">
        <div>
            <p class="eyebrow">Available tests</p>
            <h2>{{ tests|length }} item{{ '' if tests|length == 1 else 's' }}</h2>
        </div>
        <div class="legend">
            <span class="pill pill-muted">Draft</span>
            <span class="pill">Published</span>
        </div>
    </header>
    {% if tests %}
    <div class="grid three">
        {% for test in tests %}
        <article class="card test-card">
            <div class="card-top">
                <div>
                    <p class="eyebrow">ID {{ test.id }}</p>
                    <h2><a href="/tests/{{ test.id }}">{{ test.title }}</a></h2>
                    <p class="muted line-clamp">{{ test.description or "No description yet." }}</p>
                </div>
                <span class="pill {{ '' if test.is_published else 'pill-muted' }}">{{ "Published" if test.is_published else "Draft" }}</span>
            </div>
            <div class="pill-row">
                <span class="badge">Difficulty {{ test.difficulty or "N/A" }}</span>
                <span class="badge">Questions {{ test.questions|length }}</span>
                <span class="badge">ID {{ test.id }}</span>
            </div>
            <footer class="card-actions">
                <a class="link" href="/tests/{{ test.id }}">View</a>
                {% if current_user and (has_role(current_user, "AUTHOR") or has_role(current_user, "ADMIN")) %}
                <a class="link" href="/tests/{{ test.id }}/edit">Edit</a>
                {% endif %}
            </footer>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty">
        <p>No tests created yet.</p>
        {% if current_user and (has_role(current_user, "AUTHOR") or has_role(current_user, "ADMIN")) %}
        <a class="primary-btn" href="/tests/new">Create your first test</a>
        {% endif %}
    </div>
    {% endif %}
</section>

{% if my_tests and current_user and (has_role(current_user, "AUTHOR") or has_role(current_user, "ADMIN")) %}
<section class="panel">
    <header class="panel__header">
        <div>
            <p class="eyebrow">My tests</p>
            <h2>{{ my_tests|length }} authored</h2>
        </div>
    </header>
    <div class="grid">
        {% for test in my_tests %}
        <article class="card">
            <header>
                <p class="eyebrow">ID {{ test.id }}</p>
                <h3><a href="/tests/{{ test.id }}">{{ test.title }}</a></h3>
            </header>
            <p class="muted">{{ test.description or "No description yet." }}</p>
            <p class="muted">Questions: {{ test.questions|length }}</p>
            <div class="inline-actions">
                <a class="link" href="/tests/{{ test.id }}">View</a>
                <a class="link" href="/tests/{{ test.id }}/edit">Edit</a>
            </div>
        </article>
        {% endfor %}
    </div>
</section>
{% endif %}
{% endblock %}
