{% extends "base.html" %}

{% block content %}
<section class="hero">
    <div>
        <p class="eyebrow">Catalog</p>
        <h1>Published & draft tests</h1>
        <p class="lede">Browse available assessments. Authors can see their drafts.</p>
    </div>
    {% if current_user and (has_role(current_user, "AUTHOR") or has_role(current_user, "ADMIN")) %}
    <a class="primary-btn" href="/tests/new">Create test</a>
    {% else %}
    <a class="ghost-btn" href="/auth/login">Login to author</a>
    {% endif %}
</section>

<section class="panel">
    <header class="panel__header">
        <div>
            <p class="eyebrow">Available tests</p>
            <h2>{{ tests|length }} item{{ '' if tests|length == 1 else 's' }}</h2>
        </div>
    </header>
    {% if tests %}
    <div class="grid">
        {% for test in tests %}
        <article class="card">
            <header>
                <p class="eyebrow">ID {{ test.id }}</p>
                <h2><a href="/tests/{{ test.id }}">{{ test.title }}</a></h2>
            </header>
            <p class="muted">{{ test.description or "No description yet." }}</p>
            <dl class="meta">
                <div>
                    <dt>Status</dt>
                    <dd>{{ "Published" if test.is_published else "Draft" }}</dd>
                </div>
                <div>
                    <dt>Difficulty</dt>
                    <dd>{{ test.difficulty or "N/A" }}</dd>
                </div>
                <div>
                    <dt>Questions</dt>
                    <dd>{{ test.questions|length }}</dd>
                </div>
            </dl>
            <footer class="card-actions">
                <a class="link" href="/tests/{{ test.id }}">View</a>
                {% if current_user and (has_role(current_user, "AUTHOR") or has_role(current_user, "ADMIN")) %}
                <a class="link" href="/tests/{{ test.id }}/edit">Edit</a>
                {% endif %}
            </footer>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty">
        <p>No tests created yet.</p>
        {% if current_user and (has_role(current_user, "AUTHOR") or has_role(current_user, "ADMIN")) %}
        <a class="primary-btn" href="/tests/new">Create your first test</a>
        {% endif %}
    </div>
    {% endif %}
</section>

{% if my_tests and current_user and (has_role(current_user, "AUTHOR") or has_role(current_user, "ADMIN")) %}
<section class="panel">
    <header class="panel__header">
        <div>
            <p class="eyebrow">My tests</p>
            <h2>{{ my_tests|length }} authored</h2>
        </div>
    </header>
    <div class="grid">
        {% for test in my_tests %}
        <article class="card">
            <header>
                <p class="eyebrow">ID {{ test.id }}</p>
                <h3><a href="/tests/{{ test.id }}">{{ test.title }}</a></h3>
            </header>
            <p class="muted">{{ test.description or "No description yet." }}</p>
            <p class="muted">Questions: {{ test.questions|length }}</p>
            <div class="inline-actions">
                <a class="link" href="/tests/{{ test.id }}">View</a>
                <a class="link" href="/tests/{{ test.id }}/edit">Edit</a>
            </div>
        </article>
        {% endfor %}
    </div>
</section>
{% endif %}
{% endblock %}
